# 量化回测框架 支持单因子分层 
 输出统计指标 可视化超额收益PnL累积IC 分层PnL
# 回测框架（Backtest Framework）

## 简介

本回测框架旨在为金融数据分析和量化交易策略的测试提供一个灵活、高效的平台。通过Python的面向对象编程和数据处理库，用户可以快速构建、测试和评估各种交易策略。

## 功能特性

- **数据灵活性**：支持多种数据输入格式，方便用户导入自己的数据集。
- **简洁的类设计**：使用`@dataclass`装饰器，简化类的定义和初始化，使代码更具可读性和维护性。
- **自动数据初始化**：通过

__post_init__

方法，在实例化对象后自动初始化数据，准备回测环境。
- **交易成本模拟**：支持设置印花税和券商佣金，真实模拟交易过程中的成本。
- **多策略支持**：可集成不同的交易策略，支持因子模型、权重优化等高级功能。
- **灵活的时间范围**：可自定义回测的起始和结束日期，灵活控制回测区间。
- **基准设定**：支持设置基准指数，例如沪深300，用于对比策略表现。

## 主要类和方法

### Simultrading 类

核心的模拟交易类，负责回测过程的初始化和执行。

#### 属性

- 

start_date

：回测开始日期（字符串），格式为`'YYYY-MM-DD'`。
- 

end_date

：回测结束日期（字符串），格式为`'YYYY-MM-DD'`。
- 

stamp_duty

：印花税（浮点数），默认为`0.0`。可设置为`0.0005`（万分之五）。
- 

brokerage_commission

：券商佣金（浮点数），默认为`0.0`。可设置为`0.0003`（万分之三）。
- 

start_value

：初始资金（浮点数），默认为`1e+10`（一亿元）。
- 

rebalance_df

：调仓数据（`pandas.DataFrame`）。要求双层索引，`level 0`为`'date'`，`level 1`为`'stock_code'`，列名包括`'factor'`、`'weight'`。
- 

benchmark

：基准指数（字符串），默认为`'HS300'`。
- 

close_df

：股票收盘价数据（`pandas.DataFrame`）。列名为股票代码（如`'000001.XSHG'`），索引为`'date'`。
- 

strategy_name

：策略名称（字符串），默认为`'lstm'`。

#### 方法

- 

__post_init__(self)

：数据类的初始化方法，在对象实例化后自动调用，负责初始化数据和准备回测。
- 

initialize_data(self)

：数据初始化方法，执行以下操作：
  - 将

close_df

的索引转换为`datetime`类型。
  - 清理

rebalance_df

中的空值。
  - 获取回测日期范围，根据用户输入的

start_date

和

end_date

进行调整，确保在有效范围内。

## 使用方法

1. **准备数据**：确保

rebalance_df

和

close_df

按上述格式准备且有效。

2. **实例化Simultrading类**：

   ```python
   simulator = Simultrading(
       start_date='2020-01-01',
       end_date='2021-01-01',
       stamp_duty=0.0005,
       brokerage_commission=0.0003,
       start_value=1e+8,  # 一亿元初始资金
       rebalance_df=your_rebalance_dataframe,
       benchmark='HS300',
       close_df=your_close_dataframe,
       strategy_name='your_strategy_name'
   )
   ```

3. **运行回测**：调用框架中提供的回测方法，开始策略回测。

## 框架优势

- **模块化设计**：易于扩展和维护，可根据需求添加新功能或策略。
- **高性能**：针对大规模金融数据进行了性能优化。
- **真实模拟**：考虑了交易成本、滑点等因素，提升回测结果的可靠性。

## 适用场景

- **量化交易策略开发和测试**
- **金融数据分析和挖掘**
- **学术研究与教学**

## 未来计划

- **完善回测报告**：增加更多统计指标和可视化图表。
- **策略库扩展**：集成更多经典和前沿的交易策略。
- **实时交易对接**：与实盘交易接口对接，实现策略的实时交易。

## 反馈与贡献

欢迎提出建议、反馈或贡献代码。如有任何问题，请联系开发者。

---

**注意**：请根据实际情况更新`README.md`中的内容，例如替换`your_rebalance_dataframe`和`your_close_dataframe`为实际的变量名称，并补充联系方式等信息。
